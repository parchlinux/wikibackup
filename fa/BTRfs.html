<!--
title: فایل سیستم BTRfs
description: btrfs یک فایل سیستم با قابلیت های حرفه ای است.
published: true
date: 2025-07-09T01:25:46.492Z
tags: 
editor: ckeditor
dateCreated: 2025-07-09T00:44:08.108Z
-->

<p><a href="https://btrfs.readthedocs.io/en/latest/Introduction.html">داکیومنشن رسمی Btrfs</a></p>
<p>btrfs یک cow فایل سیستم جدید برای لینوکس است با هدف اضافه کردن قابلیت های حرفه ای مثل اسنپشات همچنین مدیریت خطا به اسطلاح (fault tolerance) و مدیریت اسان است.</p>
<p>جذاب ترین قابلیت های btrfs شامل فشردسازی اتوماتیک برای کمتر شدن حجم فایل ها, اسنپشات برای برگردوندن هارد به عقب, چک کردن درستی و سلامت فایل ها, رمزنگاری فایل ها, در صورت خرابی ساده تر میشود بازسازی کرد.</p>
<blockquote>
  <p>نکته: این فایل سیستم درحال توسعه است یعنی بعضی از قابلیت ها اماده برای استفاده روزمره نیستن با این حال اگر مشکلاتی که با ان دارید رو به توسعه دهندگان گزارش بدید به توسعه و حل مشکلات کمک میکند.</p>
</blockquote>
<h1>۱ پیشنیازها</h1>
<p>پکیج btrfs-progs رو نصب کنید برای عملیات های اولیه.</p>
<p>اگر میخواهید از btrfs برای پارتیشنی بوت(پارتیشنی که دایرکتوری boot/ در ان قرار دارد) استفاده کنید از بوت لودر هایی باید استفاده کنید که از این فایل سیستم پشتیبانی میکنند مثل grub.</p>
<h1>۲ ساخت فایل سیستم</h1>
<p>بعد از ساخت پارتیشن میتونید فایل سیستم رو بسازید. ساخت فایل سیستم btrfs کاملا شبیه به Ext3/4 هست با دستور زیر میتونید فایل سیستمتون رو بسازید سویچ L- اختیاری و برای اضافه کردن یادداشت استفاده میشود.</p>
<pre><code class="language-typescript"># mkfs.btrfs -L mylabel /dev/partition</code></pre>
<p>btrfs بصورت پیشفرض از nodesize 16KIB برای تغییر از این سویچ استفاده کنید.</p>
<pre><code class="language-javascript"># mkfs.btrfs -L mylabel -n 32k /dev/partition</code></pre>
<h1>۳ کانفیگ فایل سیستم</h1>
<h2>۳.۱ Copy-on-Write (CoW)</h2>
<p>بصورت پیشفرض از این حالت استفاده میشود برای تمام فایل ها همیشه. به این معناست اگر فایلی رو تغییر بدیم فایل و metadata کپی میشود در نقطه ی دیگه ای از هارد.</p>
<h3>خاموش کردن CoW</h3>
<blockquote>
  <p>توجه: خاموش کردن CoW همچنین صحت درستی فایل ها چک نمیشود به اصطلاح (checksums) هم خاموش میشود.</p>
</blockquote>
<p>&nbsp;خاموش کردن برای فایل های جدیدی که در ساب ولوم مونت شده ساخت شدن از اپشن nodatacow استفاده کنید این فقط روی فایل های جدید تاثیر میزاره</p>
<p>برای خاموش کردن برای یک فایل یا دایرکتوری.</p>
<pre><code class="language-c">$ chattr +C /dir/file</code></pre>
<h2>۳.۲ فشرده سازی</h2>
<p>Btrfs از فشرده سازی بصورت خوکار پشتیبانی میکنه. حجم فایل ها و مدیا ها رو به مقدار قابل توجهی کم میکنه فشرده سازی با الگوریتم هایی انجام میشه توانایی بهتری سریع تر فشرده سازی دارن همچنین خودتون میتونید برا اساس لول بندی که Btrfs مشخض کرده از ۱ تا ۱۵ مقداری که فشرده سازی نیاز دارید رو مشخص کنید.</p>
<h3>فعال سازی</h3>
<p>فعال سازی در دستور مونت انجام میشه برای دیدن بقیه اپشن ها میتونید به <a href="https://man.archlinux.org/man/btrfs.5">man btrfs</a> مراجعه کنید.</p>
<pre><code class="language-plaintext">$ mount -o compress=zstd /dev/sdx /mnt</code></pre>
<p>&nbsp;zstd بصورت پیشفرض از لول ۳ استفاده میکنه هرچه لول بالاتر بره سرعت بیشتر میشه.</p>
<h2>۳.۳ Subvolumes</h2>
